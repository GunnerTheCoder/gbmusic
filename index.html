<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Music Reviews</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 20px;
    }
    h1 {
      margin-bottom: 10px;
    }
    .controls {
      margin-bottom: 20px;
    }
    .controls select,
    .controls input {
      padding: 8px;
      font-size: 16px;
      margin-right: 10px;
    }
    .tabs {
      margin-bottom: 20px;
    }
    .tab-button {
      padding: 10px 20px;
      cursor: pointer;
      border: 1px solid #ccc;
      margin-right: 5px;
      background: #f9f9f9;
    }
    .tab-button.active {
      background: #ddd;
      font-weight: bold;
    }
    /* Review Card (Pill style) */
    .review-card {
      display: flex;
      align-items: center;
      border: 1px solid #ccc;
      border-radius: 30px;
      padding: 10px 20px;
      margin-bottom: 10px;
      background-color: #f9f9f9;
    }
    .review-cover {
      width: 40px;
      height: 40px;
      border-radius: 50%;
      object-fit: cover;
      margin-right: 10px;
    }
    .review-info {
      flex: 1;
      display: flex;
      flex-direction: column;
      justify-content: center;
    }
    .review-title {
      font-weight: bold;
      font-size: 16px;
      margin: 0;
      padding: 0;
    }
    .review-artist {
      font-size: 14px;
      color: #666;
      margin: 0;
      padding: 0;
    }
    .review-rating {
      font-size: 18px;
      font-weight: bold;
      margin-left: 10px;
    }
    .review-rating.gunner {
      color: blue;
    }
    .review-rating.brady {
      color: green;
    }
    /* Comments row */
    .review-comments {
      margin: 0;
      margin-top: 5px;
      font-size: 14px;
      color: #333;
      padding: 10px 20px;
    }
  </style>
</head>
<body>
  <h1>Music Reviews</h1>
  
  <div class="controls">
    <select id="review-type">
      <option value="songs">Song Reviews</option>
      <option value="albums">Album Reviews</option>
      <option value="artists">Artist Reviews</option>
    </select>
    <input type="text" id="search-input" placeholder="Search by artist..." />
  </div>
  
  <div class="tabs">
    <button class="tab-button active" data-reviewer="gunner">Gunner</button>
    <button class="tab-button" data-reviewer="brady">Brady</button>
  </div>
  
  <div id="reviews-container"></div>

  <script>
    let reviewsData = {};
    let currentReviewer = 'gunner';
    let currentReviewType = 'songs'; // "songs", "albums", or "artists"

    const reviewTypeSelect = document.getElementById('review-type');
    const searchInput = document.getElementById('search-input');
    const reviewsContainer = document.getElementById('reviews-container');

    // Switch JSON file when review type changes
    reviewTypeSelect.addEventListener('change', () => {
      currentReviewType = reviewTypeSelect.value;
      loadReviews();
    });

    // Switch reviewer tab
    document.querySelectorAll('.tab-button').forEach(button => {
      button.addEventListener('click', () => {
        document.querySelectorAll('.tab-button').forEach(btn => btn.classList.remove('active'));
        button.classList.add('active');
        currentReviewer = button.getAttribute('data-reviewer');
        renderReviews();
      });
    });

    // Search by artist
    searchInput.addEventListener('input', renderReviews);

    // Load the JSON for the current type
    function loadReviews() {
      reviewsContainer.innerHTML = '<p>Loading reviews...</p>';
      let fileName = '';
      if (currentReviewType === 'songs') fileName = 'songs.json';
      else if (currentReviewType === 'albums') fileName = 'albums.json';
      else if (currentReviewType === 'artists') fileName = 'artists.json';

      fetch(fileName)
        .then(response => response.json())
        .then(data => {
          reviewsData = data;
          renderReviews();
        })
        .catch(err => {
          console.error('Error loading reviews:', err);
          reviewsContainer.innerHTML = '<p>Error loading reviews.</p>';
        });
    }

    // Minimal Spotify fetch: just to get a thumbnail (and maybe a title)
    function fetchSpotifyDetails(spotifyLink, callback) {
      fetch('https://open.spotify.com/oembed?url=' + encodeURIComponent(spotifyLink))
        .then(res => res.json())
        .then(data => callback(null, data))
        .catch(err => callback(err, null));
    }

    // Render reviews
    function renderReviews() {
      reviewsContainer.innerHTML = '';
      if (!reviewsData[currentReviewer]) return;

      const searchQuery = searchInput.value.toLowerCase();

      // Go through each review
      reviewsData[currentReviewer].forEach(review => {
        // Filter out reviews that don't match the search by artist
        if (review.artist && !review.artist.toLowerCase().includes(searchQuery)) {
          return;
        }

        // Safety check: only display reviews that actually belong to the chosen type
        if (currentReviewType === 'songs' && !review.song) return;
        if (currentReviewType === 'albums' && !review.album) return;
        if (currentReviewType === 'artists' && !review.artistRating) return;

        // Create the "pill" container
        const card = document.createElement('div');
        card.className = 'review-card';

        // If there's a Spotify link, fetch a thumbnail. Otherwise, skip or use a placeholder.
        let coverImg = document.createElement('img');
        coverImg.className = 'review-cover';
        coverImg.src = 'https://via.placeholder.com/40'; // fallback placeholder

        if (review.spotifyLink) {
          fetchSpotifyDetails(review.spotifyLink, (err, data) => {
            if (!err && data && data.thumbnail_url) {
              coverImg.src = data.thumbnail_url;
            }
          });
        }
        card.appendChild(coverImg);

        // Middle info
        const info = document.createElement('div');
        info.className = 'review-info';

        // Title + Artist (depending on type)
        let titleText = '';
        if (currentReviewType === 'songs') {
          titleText = review.song || '';
        } else if (currentReviewType === 'albums') {
          titleText = review.album || '';
        } else if (currentReviewType === 'artists') {
          // For artist reviews, we’ll just use the name as “title”
          titleText = review.artist || '';
        }

        const titleEl = document.createElement('p');
        titleEl.className = 'review-title';
        titleEl.textContent = titleText;
        info.appendChild(titleEl);

        // For songs or albums, we can show the artist below the title
        if (currentReviewType === 'songs' || currentReviewType === 'albums') {
          const artistEl = document.createElement('p');
          artistEl.className = 'review-artist';
          artistEl.textContent = review.artist || '';
          info.appendChild(artistEl);
        }
        card.appendChild(info);

        // Rating on the right
        const rating = document.createElement('div');
        rating.className = `review-rating ${currentReviewer}`;

        if (currentReviewType === 'songs') {
          rating.textContent = (review.songRating || 0) + '/100';
        } else if (currentReviewType === 'albums') {
          rating.textContent = (review.albumRating || 0) + '/100';
        } else if (currentReviewType === 'artists') {
          rating.textContent = (review.artistRating || 0) + '/100';
        }

        card.appendChild(rating);

        reviewsContainer.appendChild(card);

        // If there are comments, show them below in a smaller text row
        if (review.comments) {
          const commentsEl = document.createElement('p');
          commentsEl.className = 'review-comments';
          commentsEl.textContent = 'Comments: ' + review.comments;
          reviewsContainer.appendChild(commentsEl);
        }
      });
    }

    // Initial load
    loadReviews();
  </script>
</body>
</html>
